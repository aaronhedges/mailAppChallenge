
<html>
<head>
<link rel="stylesheet" href="css/main.css">
<base target="_parent" />
</head>
<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>


<script>

	$(document).ready(function() {
	    //set initial state.
	
	    $('#showRead').change(function() {
		if($(this).is(":checked")) {
		    var returnVal = $(this).attr("checked", returnVal);
		}

		// clear loaded email
		$( "div" ).empty();
		// reloaded email after checkbox change
		getEmail();

	    });
	    
	    // default load email
	    getEmail();
	    
	    
	});
	
	function getEmail(){
		
		$.getJSON( "data/emails.json", function(data) {
			var items = [];
			$.each( data, function(key) {
				if($('#showRead').is(":checked")){
					// show all
					// load first email
					if (items.length == 0){
						selectEmail(data[key]._id);
					}
					var shortContent = data[key].content.substring(0,40) + '...';
					    items.push( "<div class='emailItemCls' id='" + data[key]._id + "'>" + data[key].fromName + "   " + data[key].dateReceived + "<br/>"+ data[key].subject + "<br/>"
						  + shortContent + "<hr></div>" );
					} 
				else {
					// show only unread email
					if (data[key].read == true){
						// load first email
						if (items.length == 0){
							selectEmail(data[key]._id);
						}
						var shortContent = data[key].content.substring(0,40) + '...';
						items.push("<div id='" + data[key]._id + "'>" + data[key].fromName + "   " + data[key].dateReceived + "<br/>"+ data[key].subject + "<br/>" + shortContent + "<hr></div>" );
					}
				}   
			});
			 
			  $( "<ul/>", {
			    'class' : 'emailItemCls',
			    html: items.join( "" )
			  }).appendTo( "body" );
		});
	}
	
	function selectEmail(ID){
		parent.pSelectEmail(ID);
	}

</script>

<form id="emailListForm" class="plainText">
	<input type="checkbox" id="showRead">Show Read
</form><br />

<div id="emailListDiv">
</div>

</body>
</html>
